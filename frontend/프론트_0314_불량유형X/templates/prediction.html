<!-- templates/prediction.html -->
{% extends "base.html" %}

{% block title %}불량 예측{% endblock %}

{% block content %}
<style>

    /* 예측 섹션 */
    .prediction-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
        margin-bottom: 30px;
    }
    .chart-container {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }
    .chart-header {
        margin-bottom: 20px;
    }
    .chart-title { font-size: 18px; color: #343a40; }

    /* 예측 데이터 테이블 */
    .data-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-top: 25px;
        table-layout: fixed;
    }
    .data-table th,
    .data-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
        word-break: break-word;
    }
    .data-table th {
        background: #f8f9fa;
        color: #666;
        font-weight: normal;
    }
    .prediction-value { color: #e74c3c; }
</style>

<h1 style="margin-bottom: 30px;">불량 예측</h1>

<!-- 차트 영역 -->
<div class="prediction-grid">
    <div class="chart-container">
        <div class="chart-header">
            <div class="chart-title">예측 불량률 추이</div>
        </div>
        <canvas id="trendChart"></canvas>
    </div>
    
    <div class="chart-container">
        <div class="chart-header">
            <div class="chart-title">불량 유형별 예측</div>
        </div>
        <canvas id="typeChart"></canvas>
    </div>
</div>

<!-- 상세 예측 데이터 -->
<div class="chart-container">
    <div class="chart-header">
        <div class="chart-title">상세 예측 데이터</div>
    </div>
    <table class="data-table">
        <thead>
            <tr>
                <th>라인 정보</th>
                <th>날짜</th>
                <th>예측 불량률</th>
                <th>주요 불량 유형</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>라인 1</td>
                <td>2024-02-15</td>
                <td class="prediction-value">2.8%</td>
                <td>오염</td>
            </tr>
            <tr>
                <td>라인 2</td>
                <td>2024-02-15</td>
                <td class="prediction-value">1.5%</td>
                <td>오염+손상</td>
            </tr>
            <tr>
                <td>라인 3</td>
                <td>2024-02-15</td>
                <td class="prediction-value">1.2%</td>
                <td>오염</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- 알림 UI -->
<div class="notification-container">
    <div class="notification-icon" onclick="toggleNotificationModal()">🔔</div>
</div>

<!-- 모달 알림 리스트 -->
<div class="modal-overlay" id="modalOverlay" onclick="toggleNotificationModal()"></div>
<div class="notification-modal" id="notificationModal">
    <div class="notification-header">
        <span>알림</span>
        <span style="cursor: pointer;" onclick="toggleNotificationModal()">✖</span>
    </div>
    <div class="notification-item">📩 이메일 알림: 시스템 점검 예정</div>
    <div class="notification-item">⚠️ 경고: 온도 센서 이상 감지</div>
    <div class="notification-item">✅ 보고서 전송 완료</div>
    
    <!-- 알림 설정 UI -->
    <div class="notification-settings">
        <label for="notifTime">알림 시간 설정</label>
        <select id="notifTime">
            <option value="즉시">즉시</option>
            <option value="1시간마다">1시간마다</option>
            <option value="하루 한 번">하루 한 번</option>
        </select>
        
        <label for="notifType">알림 유형 선택</label>
        <select id="notifType">
            <option value="all">모든 알림</option>
            <option value="warnings">경고 알림만</option>
            <option value="emails">이메일 알림만</option>
        </select>
        
        <label>
            <input type="checkbox" id="pushNotif"> 푸시 알림 활성화
        </label>
    </div>
</div>

<script>
    // 예측 불량률 추이 차트
    const trendCtx = document.getElementById('trendChart').getContext('2d');
    new Chart(trendCtx, {
        type: 'line',
        data: {
            labels: ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00'],
            datasets: [{
                label: '예측 불량률',
                data: [1.1, 1.5, 1.8, 2.0, 1.6, 2.5],
                borderColor: '#4dabf7',
                backgroundColor: 'rgba(77, 171, 247, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: '실제 불량률',
                data: [1.0, 1.4, 1.9, 1.8, 1.7, 2.3],
                borderColor: '#82c91e',
                backgroundColor: 'transparent',
                tension: 0.4,
                borderDash: [5, 5]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 3,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });

    // 불량 유형별 예측 차트
    const typeCtx = document.getElementById('typeChart').getContext('2d');
    new Chart(typeCtx, {
        type: 'doughnut',
        data: {
            labels: ['오염', '오염+손상'],
            datasets: [{
                data: [60, 40],
                backgroundColor: ['#5c7cfa', '#82c91e'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'right'
                }
            }
        }
    });
</script>
{% endblock %}